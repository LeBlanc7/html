<?php
  session_start();
?>
<!DOCTYPE html>
<html lang="en">

  <head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Welcome to UOS Cinema</title>

    <!-- Bootstrap core CSS -->
    <link href="/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom fonts for this template -->
    <link href="/vendor/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href='https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

    <!-- Custom styles for this template -->
    <link href="/css/clean-blog.min.css" rel="stylesheet">
    <link href="css/ticket.css" rel="stylesheet">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script>
	$(document).ready(function(){
		$('.mv_button').click(function(){
		//Selected value
		var mv_num = $(this).val();
		            
                //Ajax for calling php function            
		var hide_mv_num = "<button type='button' id='hide_mv_button' value='"
				+mv_num+ "' style='display:none'></button>"; 		

                $.ajax({
                        type : 'POST',
                        url : '/ticket/get_loc_list.php',
                        datatype : "json",
                        data : { mv_num : mv_num },
                        success : function(data) {	
                                var result = JSON.parse(data);
                                var input = "<ul class='ul_loc' style='list-style:none'>";
                        
                                for(var i=0;i<result.length;i++){
					input = input + "<li class='li_loc'><button type='button' class='loc_button' value='"
						+ result[i].loc_num + "'>"
						+ result[i].loc_nm + "</button></li>"; 
                                }
                                input = input + "</ul>";				
                             
                                $("#location").html(input);
				$(".hide_mv_num").html(hide_mv_num);                                              
         	               }       
  	              })
            	});
		$(document).on("click",".loc_button",function(){
                //Selected value
                var loc_num = $(this).val();
                var mv_num = $('#hide_mv_button').val();   
		          
                //Ajax for calling php function            
                var hide_loc_num = "<button type='button' id='hide_loc_button' value='"
                                + loc_num + "' style='display:none' ></button>";                 
		
		
                $.ajax({
                        type : 'POST',
                        url : '/ticket/get_date_list.php',
                        datatype : "json",
                        data : { loc_num : loc_num, mv_num : mv_num },
                        success : function(data) {
                                   
                                var result = JSON.parse(data);
                                var input = "<ul class='ul_date' style='list-style:none'>";
                        
                                for(var i=0;i<result.length;i++){
					var day = result[i].sch_day.toString();
					
					var day1 = day.substr(4,2);
					var day2 = day.substr(6,2); 
                                        input = input + "<li class='li_date'><button type='button' class='date_button' value='"
                                                + result[i].sch_day + "'>"
                                                + day1+ "월" + day2 + "일</button></li>"; 
                                }
                                input = input + "</ul>";
                                
                                $("#date").html(input);
                                $(".hide_loc_num").html(hide_loc_num);
                                             
                               }       
                      })
                });

		$(document).on("click",".date_button",function(){
                //Selected value
                var date_num = $(this).val();
                var mv_num = $('#hide_mv_button').val();
		var loc_num = $('#hide_loc_button').val();   
                        
		//Ajax for calling php function            
                var hide_date_num = "<button type='button' id='hide_date_button' value='"
                                + date_num + "' style='display:none' ></button>";                 
                
                
                $.ajax({
                        type : 'POST',
                        url : '/ticket/get_time_list.php',
                        datatype : "json",
                        data : { date_num : date_num, loc_num : loc_num, mv_num : mv_num },
                        success : function(data) {
				   
                                var result = JSON.parse(data);
                                var input = "";
				var temp = result[0].tht_num; 
				var flag = 0;                       

                                for(var i=0;i<result.length;i++){
					var scr_stt_time = parseInt(result[i].scr_stt_time);
					var scr_time = scr_stt_time / 10000;
									
                                        if(temp == result[i].tht_num)
					{
						if(flag == 0)
						{
							input = input + "<div class='sub_time'><h2 style='text-align:center'>"
								+ result[i].tht_num + "관</h2>"
								+"<ul class='ul_time'style='display:inline-block; list-style:none'>";
							input = input + "<div class='wrap3'><li class='li_time'><button class='time_button' type='button' value='"
								+ result[i].sch_num + "'>" +
								+ scr_time + "시</button>"+result[i].seatN+"좌석</li></div>";
							
							flag = 1;
						}
						else
						{
							input = input + "<div class='wrap3'><li class='li_time'><button class='time_button' type='button' value='"
                                                                + result[i].sch_num + "'>" +
                                                                + scr_time + "시</button>"+result[i].seatN+"좌석</li></div>";

						}
					}
					else
					{	
						input = input + "</ul></div>";
						input = input + "<div class='sub_time'><h2 style='text-align:center'>"
                                                                + result[i].tht_num + "관</h2>"
                                                                +"<ul class='ul_time' style='display:inline-block; list-style:none'>";
                                                input = input + "<div class='wrap3'><li class='li_time'><button class='time_button' type='button' value='"
                                                        + result[i].sch_num + "'>" +
                                                        + scr_time + "시</button>"+result[i].seatN+"좌석</li></div>";
					}
                                      	temp = result[i].tht_num;
                                }
                          	input = input + "</ul></div>";
                                
                                $("#time").html(input);
                                $(".hide_date_num").html(hide_date_num);
                                             
                               }       
                      })
                });
		
	});
	$(function(){
  		var sBtn = $("ul > li");    
  		sBtn.find(".mv_button").click(function(){   
   			sBtn.removeClass("active");     
   			$(this).parent().addClass("active"); 
  		})
 	});
	$(function(){
                var sBtn = $(".li_loc");    
                $(document).on("click",".loc_button",function(){   
                        sBtn.removeClass("active");     
                        $(this).parent().addClass("active"); 
                })
        });
	$(function(){
                var sBtn = $(".li_date");    
                $(document).on("click",".date_button",function(){   
                        sBtn.removeClass("active");     
                        $(this).parent().addClass("active"); 
                })
        });
	$(function(){
                var sBtn = $(".li_time");    
                $(document).on("click",".time_button",function(){   
                        sBtn.removeClass("active");     
                        $(this).parent().addClass("active"); 
                })
        });

    </script>
	<style>
		.mv_button, .loc_button , .date_button{
			margin : 3px;
		}
		.movie {
			margin : 10px;
			float :left;
		}
		ul > li > .mv_button {
			color: #fff;
  			text-decoration: none;
  			display: block;
  			padding: 5px 10px;
  			background-color: #888;
		}
		ul > li:hover > .mv_button,
 		ul > li:focus > .mv_button,
 		ul > li:active > .mv_button,
 		ul > li.active > .mv_button {
  		color: yellow;
  		background-color: #000;
 		}

		ul > li > .loc_button {
                        color: #fff;
                        text-decoration: none;
                        display: block;
                        padding: 5px 10px;
                        background-color: #888;
                }
                ul > li:hover > .loc_button,
                ul > li:focus > .loc_button,
                ul > li:active > .loc_button,
                ul > li.active > .loc_button {
                color: yellow;
                background-color: #000;
                }

		ul  > li > .date_button {
                        color: #fff;
                        text-decoration: none;
                        display: block;
                        padding: 5px 10px;
                        background-color: #888;
                }
                ul > li:hover > .date_button,
                ul > li:focus > .date_button,
                ul > li:active > .date_button,
                ul > li.active > .date_button {
                color: yellow;
                background-color: #000;
                }

		.time_button {
                        color: #fff;
                        text-decoration: none;
                        display: block;
                        padding: 5px 10px;
                        background-color: #888;
                }
                ul > .wrap3 > li:hover > .time_button,
                ul > .wrap3 > li:focus > .time_button,
                ul > .wrap3 > li:active > .time_button,
                ul > .wrap3 > li.active > .time_button {
                color: yellow;
                background-color: #000;
                }

		.location {
			margin : 10px;
			float : left;
		}
		.date {
			margin : 10px;
			float : left;
		}
		.time {
			width : 400px;
			margin : 10px;
			float :left;
		}
		.wrap3 {
			float : left;
			margin : 3px;
		}

	</style>
  </head>

  <body>
    <div class="main_template">
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-light fixed-top" id="mainNav">
      <div class="container">
        <a class="navbar-brand" href="/index.html">Home</a>
        <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
          Menu
          <i class="fa fa-bars"></i>
        </button>
        <div class="collapse navbar-collapse" id="navbarResponsive">
          <ul class="navbar-nav ml-auto">
            <?php
	    	if(!isset($_SESSION['user_id'])){
			echo "<li class='nav-item'>";
			echo "<a class='nav-link' href='/login/login.html'>로그인</a>";
			echo "</li><li class='nav-item'>";
			echo "<a class='nav-link' href='/login/member.html'>회원가입</a></li>";
		}
		else{
			$user_name = $_SESSION['user_name'];
			echo "<li class='nav-item'>";
			echo "<a class='nav-link' href='/login/member_info.html?id=".$user_name."'>회원정보</a>";
			echo "</li><li class='nav-item'>";
			echo "<a class='nav-link' href='/login/logout.php'>로그아웃</a></li>";
		}
	    ?>
            <li class="nav-item">
              <a class="nav-link" href="/admin/admin.html">관리자</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/QnA/QnA.html">QnA</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>
	
    <!-- Page Header -->
    <header class="masthead" style="background-image: url('/img/home-bg.jpg'); height: 420px">
      <div class="overlay"></div>
      <div class="container">
        <div class="row">
          <div class="col-lg-8 col-md-10 mx-auto">
            <div class="site-heading">
              <h1>예매하기</h1>
              <span class="subheading">
               <ul style = " padding-left: 0; display : inline-flex; list-style-type: none ">
                    <li class="nav-item" style = "display: inline">
                      <a class="nav-link" href="/movies/movies.html">영화목록</a>
                    </li>
                    <li class="nav-item" style = "display: inline">
                      <a class="nav-link" href="/ticket/ticket.html">예매하기</a>
                    </li>
                    <li class="nav-item" style = "display: inline">
                      <a class="nav-link" href="/theater/theater.html">상영관정보</a>
                    </li>
                  </ul>
              </span>
            </div>
          </div>
        </div>
      </div>
    </header>

    <!-- Main Content -->
    <div class="container">
      <div class="row">
        <div class="ticket">
		<div class="wrap1">
			<div class="movie">
				<h1 style="text-align:center;">영화</h1>
				<br>
				<?php
					include './get_movie_list.php';
				?>
			</div>
			<div class="location">
				<h1 style="text-align:center;">지점</h1>
				<br>
				<div id = "location">
				</div>
			</div>
			<div class="date">
				<h1 style="text-align:center;">날짜</h1>
				<br>
				<div id="date">
				</div>
			</div>
			<div class="time">
				<h1 style="text-align:center;">시간</h1>
                        	<br>
				<div id="time">
				</div>
			</div>
		</div>
		<div class="wrap2">
			<div class="next">
			</div>
		</div>
        </div>
      </div>
    </div>

    <hr>
	
	<div class ="hide">
		<div class="hide_mv_num">
		</div>
		<div class="hide_loc_num">
		</div>
		<div class="hide_date_num">
		</div>		
	</div>

    <!-- Footer -->
    <footer>
      <div class="container">
        <div class="row">
          <div class="col-lg-8 col-md-10 mx-auto">
            <ul class="list-inline text-center">
              <li class="list-inline-item">
                <a href="#">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li class="list-inline-item">
                <a href="#">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-facebook fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li class="list-inline-item">
                <a href="#">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
            </ul>
            <p class="copyright text-muted">Copyright &copy; Your Website 2018</p>
          </div>
        </div>
      </div>
    </footer>

    <!-- Bootstrap core JavaScript -->
    <script src="/vendor/jquery/jquery.min.js"></script>
    <script src="/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

    <!-- Custom scripts for this template -->
    <script src="/js/clean-blog.min.js"></script>
    </div>
  </body>

</html>

